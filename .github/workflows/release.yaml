name: Release

on:
  check_suite:
    types: completed

jobs:
  release:
    name: Send release slack notification
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11
      - name: Fetch check suite status
        run: |
          echo "CHECK_SUITE_CONCLUSION=${{ github.event.check_suite.conclusion }}" >> "$GITHUB_ENV"
          echo "conslusion: $CHECK_SUITE_CONCLUSION"
          if [ "$CHECK_SUITE_CONCLUSION" == "success" ]; then
            echo "SLACK_MESSAGE=‚úÖ Quill Icons Park has been updated.\nYou can now browse the latest quill icons at https://quill-icons-park.pages.dev" >> "$GITHUB_ENV"
          else
            echo "SLACK_MESSAGE=‚ùå Quill Icons Park could not be updated." >> "$GITHUB_ENV"
          fi
          echo "message: $SLACK_MESSAGE"
      - name: Send Slack Notification
        shell: bash
        run: |
          curl \
          -X POST \
          -H 'Content-type: application/json' \
          --data '{"text": "üóÇÔ∏è Test $CHECK_SUITE_CONCLUSION: $SLACK_MESSAGE' \
          ${{ secrets.SLACK_WEBHOOK_URL_TEST }}
